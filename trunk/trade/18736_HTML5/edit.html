<!DOCTYPE html>
<html>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 

  <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
        <link rel="stylesheet" href="my.css" />
        <style>
            /* App custom styles */
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
        </script>
        <script src="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.1.1/jquery.mobile-1.1.1.min.js">
        </script

>
<!-- 노드제이에스 서버 연결  --!>
        <script src="my.js">	
        </script>


    <script type="text/javascript">
      
    </script>



<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script>

var text="";
var textDirection ="";

/* 소켓 연결시 작동   */
$(document).ready(function(){

var socket=io.connect();

socket.on('message', function (data){

var output='';
output+='	<h3>'+data.myText+'</h3>';
drawText(data.myText,posX,posY);

});
		

		$('button').click(function(){
		
		socket.emit('message',{
		    myText: $('#myText').val(), 
          	  fontSize: $('#fontSize').val(),
		fontColor:$('#fontColor').val(),
		fontFace:$('#fontFace').val(),
		posX:posX,
		posY:posY
		});
		});


	$('#sh').click(function(){
	    ctx2 = document.getElementById("layer2").getContext("2d");
       setInterval("animate()", 100);

            textDirection = "right";
          
            textYpos = 10;
	text=$('#myText').val();


});

	$('#jw').click(function(){
		

	 ctx3 = document.getElementById("layer3").getContext("2d");            
            setInterval("animate2()", 100);
            textDirection ="right";
            textXpos = 10;
            //text = "Multimedia Science";    
	text=$('#myText').val();
});

});

/* up-down 상하이동 애니메이션*/
        function animate() {            
           ctx2.clearRect(0, 0, 380, 200);
           ctx2.globalAlpha = 1;
           ctx2.fillStyle = '#fff';
	ctx2.save();
           ctx2.fillRect(0, 0, 380, 200);   
            var metrics = ctx2.measureText(text);
            var textWidth = metrics.width;
			var textheight=metrics.height;
	var fontColor = $('#fontColor').val(); 
	  var fontSize = $('#fontSize').val(); 
            var fontFace = $('#fontFace').val();
	var posX = canvas.offsetLeft;
	var posY = canvas.offsetTop;

            if (textDirection == "right") {
                textYpos += 10;
                if (textYpos >160 ) {
                    textDirection = "left";
                }
            }
            else {
                textYpos -= 10;
                if (textYpos <0) {
                    textDirection = "right";
                }                    
            }
           ctx2.font = fontSize;
          ctx2.fillStyle = fontColor;
	ctx2.fontFace=fontFace;
          ctx2.textBaseline = 'top';
           ctx2.fillText( text,posX, textYpos);    
	
          }    

/* left-right 좌우이동 애니메이션*/
        function animate2() {            
            ctx3.clearRect(0, 0,380, 200);
            ctx3.globalAlpha = 1;
            ctx3.fillStyle = '#fff';
	ctx3.save();
            ctx3.fillRect(0, 0, 380, 200);   
            var metrics = ctx3.measureText(text);
            var textWidth = metrics.width;
  var fontColor = $('#fontColor').val(); 
	  var fontSize = $('#fontSize').val(); 
            var fontFace = $('#fontFace').val();
	var posX = canvas.offsetLeft;
	var posY = canvas.offsetTop;

            if (textDirection == "right") {
                textXpos += 10;
                if (textXpos > 380 - textWidth) {
                    textDirection = "left";
                }
            }
            else {
                textXpos -= 10;
                if (textXpos < 0) {
                    textDirection = "right";
                }                    
            }
            ctx3.font = fontSize;
            ctx3.fillStyle = fontColor;
            ctx3.fontFace=fontFace;
            ctx3.textBaseline = 'top';
            ctx3.fillText  ( text, textXpos, posY);    
	
          }    

</script>
</head>


<body>
<div id="page">
    <p><font face="Arial Rounded MT Bold">
    
    &nbsp;&nbsp;


<!-- 캔버스 4개 -->	
	<!-- 글자 쓰는 캔버스 -->
	<canvas id="layer1" width="380" height="200" style="z-index: 4;
position:absolute; border: 1px solid #000; "></canvas>
	
	<!-- 모션1 나오는 캔버스 -->
	<canvas id="layer2" width="380" height="200" style="z-index: 2;
position:absolute; border: 1px solid #000; "></canvas>

	<!-- 모션2 나오는 캔버스 -->
	<canvas id="layer3" width="380" height="200" style="z-index: 3;
position:absolute; border: 1px solid #000; "></canvas>

	<!-- 이미지 올리는 캔버스 -->
	<canvas id="layer4" width="380" height="200" style="z-index: 1;
position:absolute; border: 1px solid #000; "></canvas>
</p>
  <br/>
 &nbsp;&nbsp;
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>



  <button>Send Text</button> 

<p><font face="Arial Rounded MT Bold"><input type="text" id="myText" size="47" ></font></p>
    
                <div class="ui-grid-a">
                    <div class="ui-block-a">			
                        <input type="button" id="btn" value="submit" onclick="draw();">
                    </div>
                    <div class="ui-block-b">
                     <a data-role="button" data-theme="b" href="#page1" data-icon="star" data-iconpos="left">select </a>
                    </div>
                </div>

<!-- 글자 효과 지정 탭 -->
<div data-role="collapsible">
<h3>font</h3>

<p><font face="Arial Rounded MT Bold"><span style="font-size:12pt;">
  <!--<input type="radio" name="isFill" value="Fill" onchange="chkFill();" checked>Fill&nbsp;&nbsp;
 <!--<input type="radio" name="isFill" value="Stroke" onchange="chkFill();">Stroke&nbsp;&nbsp;-->
 
  size:<p/> <input id="fontSize" type="range" min="10" max="60" step="5" value="50" onchange="changeFont();" />
  <p/>font: <select id="fontFace" onchange="changeFont();">

        <option value="Tahoma" selected>Tahoma</option>
        <option value="Verdana">Verdana</option>
        <option value="Gulim">Gulim</option>
        <option value="Georgia">Georgia</option>
        <option value="Symbol">Symbol</option>
        <option value="Terminal">Terminal</option>
        </select> 

		Color: <select id="fontColor" onchange="changeColor(1);">

        <option value="Black" selected>Black</option>
        <option value="Red">Red</option>
        <option value="Blue">Blue</option>
        <option value="Green">Green</option>
        <option value="Yellow">Yellow</option>
        </select> 
</span></font>

  &nbsp; <font face="Arial Rounded MT Bold"><form type="text" name="myText" id="myText" size="47" onkeypress="inputText(event.keyCode);" onkeyup="inputBackSpace(event.keyCode);">
</form></font> 
</div>



<!-- 이미지 불러오기 탭 -->
<div data-role="collapsible">
<h3>Photo</h3>
 <div data-role="content"> 

     <fieldset class="ui-grid-a">
    <input type="file" id="userImage">
    <input type="button" onclick="doIt()" value="image"><br/>
    <canvas id="canvas" style="border: 1px solid black; height: 400px; width: 400px;"/>
                </div>
        </fieldset>
    </div>
</div>

<!-- 모션 쓰기 탭 -->
<div data-role="collapsible">
<h3>Motion</h3>
  <input type="button" id="sh" value="up-down" onclick="animate2()">
  <input type="button" id="jw" value="left-right">
</div>

 </body>

</html>







<script type="text/javascript">	


window.onDOMReady = Init();
if(window.addEventListener){
    window.addEventListener('load', Init, false); 
}
window.onDOMReady = Init();
var layer1, layer2, layer3, ctx1, ctx2, ctx3, msgDiv, fontColor, fontFace;
var posX=20;
var posY=30;
var WIDTH=380;
var HEIGHT=200;
var isFill = true;
var dragok=false,
text= document.getElementById('myText').value,
fontSize=document.getElementById('fontSize').value,
textLength = (text.length * fontSize)/2;

function Init() {     
  layer1 = document.getElementById('layer1');
  ctx1 = layer1.getContext('2d');     
  ctx1.font = eval("'"+ document.getElementById('fontSize').value +'px '+ document.getElementById('fontFace').value+"'");
  ctx1.fillStyle = document.getElementById('fontColor').value;
  ctx1.textBaseline = "top";

layer1.onmousedown = myDown;
 layer1.onmouseup = myUp;
 return setInterval(draw, 40);
}


/*   캔버스 초기화 함수   */

function clear() {
 ctx1.clearRect(0, 0, WIDTH, HEIGHT);
}



/*   캔버스 내 글자 쓰기 함수   */

function drawText(posX,posY) { 
ctx1.fillText(text, posX  , posY);
ctx1.beginPath();
  ctx1.closePath();
  ctx1.stroke();

}

/*   캔버스 내 텍스트창에 있는 글자 쓰기 함수   */

function draw() {
    text = document.getElementById('myText').value,

    textLength = (text.length * fontSize)/2;
clear();

 drawText(posX, posY);
}

/*   캔버스 내 글자 드래그? 함수   */

function myMove(e){
 if (dragok){
  posX = e.pageX - layer1.offsetLeft;
  posY = e.pageY - layer1.offsetTop;
 }
}

function myDown(e){
 if (e.pageX < posX + textLength + layer1.offsetLeft && e.pageX > posX - textLength + layer1.offsetLeft && e.pageY < posY + 15 + layer1.offsetTop &&
 e.pageY > posY -15 + layer1.offsetTop){
  posX = e.pageX - layer1.offsetLeft;
  posY = e.pageY - layer1.offsetTop;
  dragok = true;
  layer1.onmousemove = myMove;
 }
}

function myUp(){
 dragok = false;
 layer1.onmousemove = null;
}
  


/*   ??????   */

function chkFill(){
  isFill = myForm.isFill[0].checked;
  clearCanvas();
  drawText(myText.value,posX,posY); 
}

/*   캔버스 내 글자 폰트 변경 함수   */
function changeFont(){
 
  ctx1.font = eval("'"+ document.getElementById('fontSize').value +'px '+ document.getElementById('fontFace').value+"'");
  drawText(myText.value,posX,posY);  
}


/*  캔버스 내 글자색 변경 함수   */
function changeColor(){
    ctx1.fillStyle = document.getElementById('fontColor').value;
   drawText(myText.value,posX,posY);  
}

/*  이미지 불러오기 함수   */
function doIt() {
        var reader = new FileReader();
        reader.onload = (function(e) {
            var img = new Image();
            img.src = e.target.result;
            var layer4 = document.getElementById("layer4");
            var ctx4 = layer4.getContext("2d");
            ctx4.drawImage(img,10,10,200,200);
          }
        );
        reader.readAsDataURL(document.getElementById('userImage').files[0]);
      }

</script>